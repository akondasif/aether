Aether disk search engine

0. Introduction
Aether is an application for indexing and searching unstructured collections.
Unstructured, in a way that the collections may be overlapping, may be randomly put together, or may be too large to go through manually.
The collections themselves is meant to be mainly books and documents, but also music may work.
For items like music we are solely dependent on indexing metadata.
Since the collections may be overlapping, the main id is an (md5) checksum, and it won't be indexed again if already found.
The application consists of a web client, that may connect to a server.
Both searching and indexing is initiated through the web client.
The server may be a single server, or a set of clustered/cloudy servers.
It is currently set for a standard analyzer (presumably for English), and is automatically able to recognize language.
Given a bit of manual training with classifier software, it is possible to use the training data to automatically classify the documents during indexing.

1. Installing

Unpack language profiles (...).
Install other software, like ebook-convert, pdftotext, djvutxt.
Run (after configuring) with mvn package, mvn jetty:run

2. Configuration
Sample files are available.
For standalone single node: aether.prop.standalone
For standalone using cloud services: aether.prop.cloud
For two nodes: aether.prop.testnode1 aether.prop.testnode2

Configure aether.prop:

2.1 Mandatory configuration.
2.1.1 General
Which directories to include, and subdirectories to exclude.
dirlist=file:/home/dir/dir1,hdfs:/home/dir/dir2...
dirlistnot=/home/dir/dir1/tmp
Known uses are file, hdfs and none (defaulting to file).

Name of the node.
Nodename=...
(But if db is hibernate or lucene, it is localhost anyway).

How many to max reindex each turn, or 0 for no limit.
reindexlimit=10000

How many to max index each turn, or 0 for no limit.
indexlimit=10000

Don't try to index if the file has failed this many times
failedlimit=10

Number of seconds for Tika conversion timeout
tikatimeout=600

Number of seconds for Other conversion timeout
othertimeout=600

2.1.2 Database
The database may be HBase, DataNucleus/HBase or Hibernate/H2.

2.1.2.1 Hibernate/H2
Hibernate/H2 relevant settings:
db=hibernate
h2dir=...
Hibernate/H2 is for standalone only.

2.1.2.2 Hbase
Hbase relevant settings:
db=hbase
hbasequorum=localhost
hbaseport=2181
hbasemaster=localhost:2181

2.1.2.3 DataNucleus/HBase
DataNucleus/HBase elevant settings:
db=datanucleus

2.1.3 Indexing/search:
Can be Lucene directly or Solr.
Lucene is for standalone only.

2.1.3.1 Lucene
Lucene relevant settings:
index=lucene
lucenepath=...

2.1.3.2 Solr
Solr relevant settings:
index=solr
solrurl=http://localhost:8983/solr/mystuff

Solr server needs new fields for schema.xml:
<field name="lang" type="text_general" indexed="true" stored="true"/>
<field name="metadata" type="text_general" indexed="true" stored="false"/>
<copyField source="metadata" dest="text"/>
and change for the following field:
<field name="content" type="text_general" indexed="false" stored="false" multiValued="true"/>

Use example/schema.xml.default

Increase the following in solrconfig.xml:
<maxBooleanClauses>16384</maxBooleanClauses>

2.1.3.3 Langdetect
Download from https://code.google.com/p/language-detection/wiki/Downloads,
and put profiles* in the same dir as pom.xml.

2.2 Non-mandatory

2.2.1 General
If using Hadoop HDFS
hdfsconffs=hadoop uri (sets fs.default.name)

Where to log
logdir=...

Whether to enable downloading
downloader=true

Whether to use authenication
authenticate=true
The admin user has username/password admin/admin, and the user has user/user.
The admin has access to the control panel, and will see more search results than the user.
The admin user will get results regarding indexing time usage and error messages from the indexing.
If no authentication is used, everything is open.
Accessing from localhost will determine admin right in both cases.

2.2.2 Classifying
There are two types, Mahout and OpenNLP.

2.2.2.1 Mahout
Mahout relevant settings:
classify=mahout
mahoutalgorithm=bayes
mahaoutmodelpath=.../mahout/model
mahoutlabelindexfilepath=.../mahout/labelindex
mahoutdictionarypath=.../mahout/dataset-vectors/dictionary.file-0
mahoutdocumentfrequencypath=.../mahout/dataset-vectors/df-count/part-r-00000
mahaoutconffs=hadoop uri (sets fs.default.name in this specific case)

Training could be based on the Bayes part of 
examples/bin/classify-20newsgroups.sh in the Mahout distribution.

2.2.2.2 OpenNLP
OpenNLP relevant settings:
classify=opennlp
opennlpmodelpath=.../opennlp/en-doccat.bin

Training is standard, done with ./bin/opennlp DoccatTrainer in the
OpenNLP distribution.

2.2.3 Zookeeper
Configured by
zookeeper=...
Should be used in a multinode environment (not yet mandatory).

2.2.4 Highlight and MoreLikeThis
Configured by
highlightmlt=true

If using Solr, also set
termVectors, termPositions, and termOffsets, and storage
<field name="content" type="text_general" indexed="true" stored="true" multiValued="true" termVectors="true" termPositions="true" termOffsets="true"/>

Beware that this also stores the content, and increases disk space usage.

Use example/schema.xml.highlightmlt

3. GUI

3.1 Search
Use Lucene syntax
Searchable fields:
Id, lang, metadata, content (Lucene), text (Solr).

Query parser is behaving differently according to Lucene or Solr, see specific docs.

3.2 Control panel
The control panel is admin functionality not seen by the user.
Here we see adding content from the file system, index, reindexing, consistency checks, cleaning, statistics, database querying.

Index filesystem new items
Button: Crawl the whole filesystem for new, and index.
Textfield: Use only the given path.
Filesystem index on changed md5 checks if md5 has changed, and reindexes.

Filesystem add new
Button: Add new files from the filesystem, but do not index.
Textfield: Use only the given path.

Index non-indexed items:
Button: Index all previously non-indexed (including failed).
Textfield: Use only the given path.
Index of suffix: Try to index all known items with suffix.

Reindex, textfield, use only the given path.
Reindex on before or after given date.

Consistency checks, with cleaning.
It lists files not currenly present in the filesystem (will be cleaned).
It also lists non-existing files (encoding problems) and new files.

Stats, listing non-indexed, memory usage or overlapping directories.

Database, get items related to md5 id.
Database search, fields indexed, convertsw, classification, failedreason, noindexreason, timeoutreason.

3.3 General

Status label has rows for t(ika) queue, o(ther) queue, i(ndex) queue, queued / running.
Also, a d for counting dirty database objects.

4. Caution
Multitasking issues, some locking may be insufficient, it is at best at a very coarse level.
For standalone the ordinary java locking is using.
For multinode zookeeper is needed, or some concurrent modification will happen.
With zookeeper, only node may index at a given time due to database access.